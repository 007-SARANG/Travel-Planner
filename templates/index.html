<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TripWise - Your Intelligent Trip Planner</title>
    <meta name="description" content="AI-powered travel planning with real-time prices, instant booking links, and personalized recommendations">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='favicon.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500;1,600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Immersive Background -->
    <div class="immersive-bg">
        <div class="bg-overlay"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-globe-americas"></i>
                </div>
                <span class="logo-text">TripWise</span>
            </div>
            <div class="nav-actions">
                <div class="currency-dropdown">
                    <select class="currency-selector" id="currencySelect" title="Select Currency">
                        <option value="INR" selected>₹ INR</option>
                        <option value="USD">$ USD</option>
                        <option value="EUR">€ EUR</option>
                        <option value="GBP">£ GBP</option>
                    </select>
                </div>
                <button class="nav-btn" id="historyToggle" title="Trip History">
                    <i class="fas fa-history"></i>
                </button>
                <button class="nav-btn" id="themeToggle" title="Toggle Theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn-new-trip" id="resetBtn">
                    <i class="fas fa-plus"></i>
                    <span>New Trip</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero-section" id="heroSection">
            <h1 class="hero-title">Plan Your Perfect Journey</h1>
            
            <!-- Feature Cards -->
            <div class="feature-cards">
                <div class="feature-card flights-card">
                    <div class="card-icon"><i class="fas fa-plane"></i></div>
                    <img src="https://images.unsplash.com/photo-1436491865332-7a61a109cc05?w=400&h=300&fit=crop" alt="Flights" class="card-bg-img">
                    <div class="card-content">
                        <h3>Flights</h3>
                        <p>Best deals across 500+ airlines</p>
                        <span class="card-price">From ₹15,000</span>
                    </div>
                </div>
                <div class="feature-card trains-card">
                    <div class="card-icon"><i class="fas fa-train"></i></div>
                    <img src="https://images.unsplash.com/photo-1474487548417-781cb71495f3?w=400&h=300&fit=crop" alt="Trains" class="card-bg-img">
                    <div class="card-content">
                        <h3>Trains & Buses</h3>
                        <p>All ground transport options</p>
                        <span class="card-price">From ₹500</span>
                    </div>
                </div>
                <div class="feature-card hotels-card">
                    <div class="card-icon"><i class="fas fa-hotel"></i></div>
                    <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?w=400&h=300&fit=crop" alt="Hotels" class="card-bg-img">
                    <div class="card-content">
                        <h3>Hotels</h3>
                        <p>From budget to ultra-luxury</p>
                        <span class="card-price">From ₹2,000</span>
                    </div>
                </div>
                <div class="feature-card weather-card">
                    <div class="card-icon"><i class="fas fa-cloud-sun"></i></div>
                    <img src="https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=400&h=300&fit=crop" alt="Weather" class="card-bg-img">
                    <div class="card-content">
                        <h3>Weather</h3>
                        <p>Real-time forecasts</p>
                        <span class="card-price">Live Updates</span>
                    </div>
                </div>
            </div>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-bar">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Search your travel plan..."
                        autocomplete="off"
                    >
                    <button class="voice-btn" id="voiceBtn" title="Voice Input">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="dream-btn" id="sendBtn">
                        Dream It
                    </button>
                </div>
            </div>

            <!-- Featured Destinations -->
            <section class="destinations-section">
                <div class="section-header">
                    <h2>Featured Destinations</h2>
                    <div class="carousel-nav">
                        <button class="carousel-btn prev" id="destPrev"><i class="fas fa-chevron-left"></i></button>
                        <button class="carousel-btn next" id="destNext"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="destinations-carousel" id="destinationsCarousel">
                    <div class="destination-card" data-destination="Bali">
                        <img src="https://images.unsplash.com/photo-1537996194471-e657df975ab4?w=400&h=300&fit=crop" alt="Bali">
                        <div class="destination-info">
                            <span class="destination-name">Bali, Indonesia</span>
                            <button class="explore-btn">Explore</button>
                        </div>
                    </div>
                    <div class="destination-card" data-destination="Paris">
                        <img src="https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=400&h=300&fit=crop" alt="Paris">
                        <div class="destination-info">
                            <span class="destination-name">Paris, France</span>
                            <button class="explore-btn">Explore</button>
                        </div>
                    </div>
                    <div class="destination-card" data-destination="Maldives">
                        <img src="https://images.unsplash.com/photo-1514282401047-d79a71a590e8?w=400&h=300&fit=crop" alt="Maldives">
                        <div class="destination-info">
                            <span class="destination-name">Maldives</span>
                            <button class="explore-btn">Explore</button>
                        </div>
                    </div>
                    <div class="destination-card" data-destination="Switzerland">
                        <img src="https://images.unsplash.com/photo-1530122037265-a5f1f91d3b99?w=400&h=300&fit=crop" alt="Switzerland">
                        <div class="destination-info">
                            <span class="destination-name">Switzerland</span>
                            <button class="explore-btn">Explore</button>
                        </div>
                    </div>
                    <div class="destination-card" data-destination="Dubai">
                        <img src="https://images.unsplash.com/photo-1512453979798-5ea266f8880c?w=400&h=300&fit=crop" alt="Dubai">
                        <div class="destination-info">
                            <span class="destination-name">Dubai, UAE</span>
                            <button class="explore-btn">Explore</button>
                        </div>
                    </div>
                    <div class="destination-card" data-destination="Tokyo">
                        <img src="https://images.unsplash.com/photo-1540959733332-eab4deabeeaf?w=400&h=300&fit=crop" alt="Tokyo">
                        <div class="destination-info">
                            <span class="destination-name">Tokyo, Japan</span>
                            <button class="explore-btn">Explore</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Searches (Hidden by default) -->
            <div class="recent-searches" id="recentSearches" style="display: none;">
                <div class="section-header">
                    <h2><i class="fas fa-history"></i> Recent Searches</h2>
                    <button class="clear-btn" id="clearHistory">Clear All</button>
                </div>
                <div class="recent-list" id="recentList"></div>
            </div>
        </section>

        <!-- Chat Container (Hidden initially) -->
        <div class="chat-wrapper" id="chatWrapper">
            <div class="chat-header">
                <button class="btn-back" id="backToHome">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back</span>
                </button>
                <div class="chat-title">
                    <i class="fas fa-robot"></i>
                    <span>AI Trip Planner</span>
                </div>
                <button class="btn-save" id="saveTripBtn" title="Save Trip">
                    <i class="fas fa-bookmark"></i>
                </button>
            </div>
            
            <!-- AI Progress -->
            <div class="ai-progress" id="aiProgress">
                <div class="progress-step" data-step="1">
                    <div class="step-icon"><i class="fas fa-search"></i></div>
                    <span>Searching</span>
                </div>
                <div class="progress-connector"></div>
                <div class="progress-step" data-step="2">
                    <div class="step-icon"><i class="fas fa-filter"></i></div>
                    <span>Filtering</span>
                </div>
                <div class="progress-connector"></div>
                <div class="progress-step" data-step="3">
                    <div class="step-icon"><i class="fas fa-magic"></i></div>
                    <span>Optimizing</span>
                </div>
                <div class="progress-connector"></div>
                <div class="progress-step" data-step="4">
                    <div class="step-icon"><i class="fas fa-check"></i></div>
                    <span>Done!</span>
                </div>
            </div>
            
            <div class="chat-container" id="chatContainer"></div>
            
            <!-- Follow-up Input Bar -->
            <div class="chat-input-bar" id="chatInputBar">
                <div class="chat-input-wrapper">
                    <input 
                        type="text" 
                        id="followUpInput" 
                        placeholder="Ask a follow-up question..."
                        autocomplete="off"
                    >
                    <button class="chat-voice-btn" id="chatVoiceBtn" title="Voice Input">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="chat-send-btn" id="chatSendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Travel Options Panel -->
    <div class="travel-options-panel" id="travelOptionsPanel">
        <div class="options-toggle" id="optionsToggle">
            <i class="fas fa-sliders-h"></i>
            <span>Options</span>
        </div>
        <div class="options-content">
            <div class="option-group">
                <label><i class="fas fa-plane-departure"></i> Depart</label>
                <input type="date" id="travelDate" class="option-input">
            </div>
            <div class="option-group" id="returnDateGroup">
                <label><i class="fas fa-plane-arrival"></i> Return</label>
                <input type="date" id="returnDate" class="option-input">
            </div>
            <div class="option-group">
                <label><i class="fas fa-users"></i> Travelers</label>
                <div class="traveler-selector">
                    <button class="traveler-btn" id="travelerMinus">−</button>
                    <span id="travelerCount">1</span>
                    <button class="traveler-btn" id="travelerPlus">+</button>
                </div>
            </div>
            <div class="option-group">
                <label><i class="fas fa-exchange-alt"></i> Trip Type</label>
                <select id="tripType" class="option-select">
                    <option value="roundtrip">Round Trip</option>
                    <option value="oneway">One Way</option>
                </select>
            </div>
            <div class="option-group">
                <label><i class="fas fa-wallet"></i> Budget</label>
                <select id="budgetRange" class="option-select">
                    <option value="any">Any</option>
                    <option value="budget">Budget</option>
                    <option value="midrange">Mid-Range</option>
                    <option value="luxury">Luxury</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <i class="fas fa-plane loader-icon"></i>
            </div>
            <p class="loading-text" id="loadingText">Finding the best options...</p>
            <div class="loading-dots">
                <span></span><span></span><span></span>
            </div>
        </div>
    </div>

    <!-- Trip History Sidebar -->
    <div class="sidebar" id="tripSidebar">
        <div class="sidebar-header">
            <h3><i class="fas fa-history"></i> Trip History</h3>
            <button class="sidebar-close" id="sidebarClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="sidebar-content" id="tripHistoryList">
            <div class="empty-state">
                <i class="fas fa-suitcase"></i>
                <p>No saved trips yet</p>
            </div>
        </div>
    </div>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- PWA Install Prompt -->
    <div class="pwa-prompt" id="pwaInstallPrompt" style="display: none;">
        <i class="fas fa-mobile-alt"></i>
        <div class="pwa-text">
            <strong>Install TravelAI</strong>
            <span>Quick access from home screen</span>
        </div>
        <button class="pwa-btn" id="pwaInstallBtn">Install</button>
        <button class="pwa-close" id="pwaDismiss"><i class="fas fa-times"></i></button>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    
    <!-- Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(reg => console.log('✅ SW registered'))
                    .catch(err => console.log('❌ SW error:', err));
            });
        }

        // PWA Install
        let deferredPrompt;
        const pwaPrompt = document.getElementById('pwaInstallPrompt');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            setTimeout(() => {
                if (!localStorage.getItem('pwaPromptDismissed')) {
                    pwaPrompt.style.display = 'flex';
                }
            }, 15000);
        });

        document.getElementById('pwaInstallBtn')?.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                await deferredPrompt.userChoice;
                deferredPrompt = null;
                pwaPrompt.style.display = 'none';
            }
        });

        document.getElementById('pwaDismiss')?.addEventListener('click', () => {
            pwaPrompt.style.display = 'none';
            localStorage.setItem('pwaPromptDismissed', 'true');
        });
    </script>
</body>
</html>
